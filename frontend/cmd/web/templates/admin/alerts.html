{{define "content"}}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="mb-0"><i class="bi bi-exclamation-triangle me-2 text-warning"></i>Inventory Alerts</h4>
    <span class="badge bg-warning text-dark fs-6">{{len .Alerts}} items low on stock</span>
</div>

<div class="alert alert-info" role="alert">
    <i class="bi bi-info-circle me-2"></i>
    Items with quantity below 10 are displayed here. Click "Adjust" to update the quantity.
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Current Quantity</th>
                        <th>Price</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="alertsTableBody">
                    {{if .Alerts}}
                    {{range .Alerts}}
                    <tr>
                        <td>{{.Id}}</td>
                        <td>
                            {{if .Image}}
                            <img src="{{.Image}}" alt="{{.Name}}" class="img-thumbnail" style="width: 50px; height: 50px; object-fit: cover;">
                            {{else}}
                            <span class="text-muted">-</span>
                            {{end}}
                        </td>
                        <td><strong>{{.Name}}</strong></td>
                        <td>{{.Type}}</td>
                        <td>
                            <span class="badge bg-danger fs-6">{{.Quantity}}</span>
                        </td>
                        <td>${{printf "%.2f" .Price}}</td>
                        <td>
                            <button type="button" class="btn btn-sm btn-warning" data-bs-toggle="modal"
                                data-bs-target="#adjustModal{{.Id}}">
                                <i class="bi bi-plus-minus me-1"></i>Adjust
                            </button>
                            <a href="/admin/bread/{{.Id}}/edit" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-pencil"></i>
                            </a>
                        </td>
                    </tr>

                    <!-- Adjust Modal for each item -->
                    <div class="modal fade" id="adjustModal{{.Id}}" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Adjust Quantity: {{.Name}}</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form method="POST" action="/admin/alerts/{{.Id}}/adjust">
                                    <div class="modal-body">
                                        <div class="mb-3">
                                            <label for="quantity{{.Id}}" class="form-label">New Quantity</label>
                                            <input type="number" class="form-control" id="quantity{{.Id}}" name="quantity"
                                                value="{{.Quantity}}" min="0" required>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button type="button" class="btn btn-outline-success flex-fill"
                                                onclick="document.getElementById('quantity{{.Id}}').value = parseInt(document.getElementById('quantity{{.Id}}').value) + 10">
                                                +10
                                            </button>
                                            <button type="button" class="btn btn-outline-success flex-fill"
                                                onclick="document.getElementById('quantity{{.Id}}').value = parseInt(document.getElementById('quantity{{.Id}}').value) + 25">
                                                +25
                                            </button>
                                            <button type="button" class="btn btn-outline-success flex-fill"
                                                onclick="document.getElementById('quantity{{.Id}}').value = parseInt(document.getElementById('quantity{{.Id}}').value) + 50">
                                                +50
                                            </button>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" class="btn btn-warning">Update Quantity</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    {{end}}
                    {{else}}
                    <tr>
                        <td colspan="7" class="text-center text-muted py-4">
                            <i class="bi bi-check-circle fs-1 d-block mb-2 text-success"></i>
                            No low stock alerts! All items are well stocked.
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
    </div>
</div>
{{end}}

{{define "scripts"}}
<script>
    // SSE for real-time alerts updates
    var alertsSource = new EventSource("/admin/alerts-stream");
    alertsSource.onmessage = function(event) {
        var data = JSON.parse(event.data);
        // Could update the alerts table dynamically here
        console.log('Alerts updated:', data);
    };
    alertsSource.onerror = function(error) {
        console.error('Alerts SSE error:', error);
    };
</script>
{{end}}
